# Milestone M1 — MVP Core (No Agents)

This document elaborates the tasks required to deliver the M1 milestone described in [PLAN.md](PLAN.md).

## 1. Task COB v1
- [ ] Define the `task@v1` COB schema with fields for identity, state, and artifact links.
- [ ] Implement CLI commands to create, update, and close Task COBs.
- [ ] Support manual checkpointing from the CRDT comment store into a Task COB snapshot.
- [ ] Implement a periodic timer to trigger automatic CRDT → COB checkpoints.
- [ ] Write property tests for create/update/close flows and checkpoint merging.

## 2. CRDT Comments
- [ ] Build a local Automerge store for task comments.
- [ ] Map comments to source using AST anchors and fall back to range/diff context when needed.
- [ ] Expose a snapshot function that publishes anchored comments into the corresponding Task COB.
- [ ] Add tests covering anchor relocation and merge behavior.

## 3. Runners
- [ ] Define a runner interface that supports build, test, and artifact collection.
- [ ] Implement a Nix runner that executes `nix build` with the repo’s `flake.nix`.
- [ ] Implement a rootless container runner for projects without Nix.
- [ ] Allow per‑repo configuration to select between Nix and container runners.
- [ ] Record runner outputs for attachment to Task COBs.

## 4. Artifacts and Manifests
- [ ] Implement S3 client functionality for uploading build artifacts.
- [ ] Implement IPFS client functionality for adding and pinning manifest files.
- [ ] Store S3 URLs and IPFS CIDs in the related Task COB.
- [ ] Provide a retrieval command that downloads artifacts and verifies hashes.
- [ ] Benchmark artifact fetch latency and ensure p95 < 3s for 100 MB.

## 5. Realtime Sessions (WebRTC)
- [ ] Establish WebRTC data channels for collaborative editing.
- [ ] Use Y‑CRDT to synchronize buffers between peers.
- [ ] Periodically checkpoint session buffers into a Git session branch patch.
- [ ] Announce active sessions via a lightweight COB pointer.
- [ ] Write integration tests for realtime editing and patch generation.

## 6. Headless Mode
- [ ] Provide a headless node that can act as signaling relay and optional TURN server.
- [ ] Enable IPFS pinning and S3 uploads from the headless node.
- [ ] Manage a runner pool on the headless node for remote builds.
- [ ] Document configuration and deployment steps for headless operation.

## 7. Exit Checks
- [ ] Demonstrate two NATed peers collaborating on tasks with realtime sessions and checkpoints.
- [ ] Verify builds reproduce across nodes using both Nix and container runners.
- [ ] Confirm artifacts are uploaded to S3, manifests pinned on IPFS, and links embedded in Task COBs.
- [ ] Measure artifact fetch latency and confirm p95 < 3s for 100 MB payloads.

